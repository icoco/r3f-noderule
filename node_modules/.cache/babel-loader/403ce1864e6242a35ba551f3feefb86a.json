{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.buildInProdFollowPrefix = exports.buildBetweenProdsFollowPrefix = exports.computeAllProdsFollows = exports.ResyncFollowsWalker = void 0;\n\nconst rest_1 = require(\"./rest\");\n\nconst first_1 = require(\"./first\");\n\nconst forEach_1 = __importDefault(require(\"lodash/forEach\"));\n\nconst assign_1 = __importDefault(require(\"lodash/assign\"));\n\nconst constants_1 = require(\"../constants\");\n\nconst gast_1 = require(\"@chevrotain/gast\"); // This ResyncFollowsWalker computes all of the follows required for RESYNC\n// (skipping reference production).\n\n\nclass ResyncFollowsWalker extends rest_1.RestWalker {\n  constructor(topProd) {\n    super();\n    this.topProd = topProd;\n    this.follows = {};\n  }\n\n  startWalking() {\n    this.walk(this.topProd);\n    return this.follows;\n  }\n\n  walkTerminal(terminal, currRest, prevRest) {// do nothing! just like in the public sector after 13:00\n  }\n\n  walkProdRef(refProd, currRest, prevRest) {\n    const followName = buildBetweenProdsFollowPrefix(refProd.referencedRule, refProd.idx) + this.topProd.name;\n    const fullRest = currRest.concat(prevRest);\n    const restProd = new gast_1.Alternative({\n      definition: fullRest\n    });\n    const t_in_topProd_follows = (0, first_1.first)(restProd);\n    this.follows[followName] = t_in_topProd_follows;\n  }\n\n}\n\nexports.ResyncFollowsWalker = ResyncFollowsWalker;\n\nfunction computeAllProdsFollows(topProductions) {\n  const reSyncFollows = {};\n  (0, forEach_1.default)(topProductions, topProd => {\n    const currRefsFollow = new ResyncFollowsWalker(topProd).startWalking();\n    (0, assign_1.default)(reSyncFollows, currRefsFollow);\n  });\n  return reSyncFollows;\n}\n\nexports.computeAllProdsFollows = computeAllProdsFollows;\n\nfunction buildBetweenProdsFollowPrefix(inner, occurenceInParent) {\n  return inner.name + occurenceInParent + constants_1.IN;\n}\n\nexports.buildBetweenProdsFollowPrefix = buildBetweenProdsFollowPrefix;\n\nfunction buildInProdFollowPrefix(terminal) {\n  const terminalName = terminal.terminalType.name;\n  return terminalName + terminal.idx + constants_1.IN;\n}\n\nexports.buildInProdFollowPrefix = buildInProdFollowPrefix;","map":{"version":3,"sources":["../../../../src/parse/grammar/follow.ts"],"names":[],"mappings":";;;;;;;;;;;;;AAAA,MAAA,MAAA,GAAA,OAAA,CAAA,QAAA,CAAA;;AACA,MAAA,OAAA,GAAA,OAAA,CAAA,SAAA,CAAA;;AACA,MAAA,SAAA,GAAA,eAAA,CAAA,OAAA,CAAA,gBAAA,CAAA,CAAA;;AACA,MAAA,QAAA,GAAA,eAAA,CAAA,OAAA,CAAA,eAAA,CAAA,CAAA;;AACA,MAAA,WAAA,GAAA,OAAA,CAAA,cAAA,CAAA;;AACA,MAAA,MAAA,GAAA,OAAA,CAAA,kBAAA,CAAA,C,CAGA;AACA;;;AACA,MAAa,mBAAb,SAAyC,MAAA,CAAA,UAAzC,CAAmD;AAGjD,EAAA,WAAA,CAAoB,OAApB,EAAiC;AAC/B;AADkB,SAAA,OAAA,GAAA,OAAA;AAFb,SAAA,OAAA,GAAuC,EAAvC;AAIN;;AAED,EAAA,YAAY,GAAA;AACV,SAAK,IAAL,CAAU,KAAK,OAAf;AACA,WAAO,KAAK,OAAZ;AACD;;AAED,EAAA,YAAY,CACV,QADU,EAEV,QAFU,EAGV,QAHU,EAGa,CAEvB;AACD;;AAED,EAAA,WAAW,CACT,OADS,EAET,QAFS,EAGT,QAHS,EAGc;AAEvB,UAAM,UAAU,GACd,6BAA6B,CAAC,OAAO,CAAC,cAAT,EAAyB,OAAO,CAAC,GAAjC,CAA7B,GACA,KAAK,OAAL,CAAa,IAFf;AAGA,UAAM,QAAQ,GAAkB,QAAQ,CAAC,MAAT,CAAgB,QAAhB,CAAhC;AACA,UAAM,QAAQ,GAAG,IAAI,MAAA,CAAA,WAAJ,CAAgB;AAAE,MAAA,UAAU,EAAE;AAAd,KAAhB,CAAjB;AACA,UAAM,oBAAoB,GAAG,CAAA,GAAA,OAAA,CAAA,KAAA,EAAM,QAAN,CAA7B;AACA,SAAK,OAAL,CAAa,UAAb,IAA2B,oBAA3B;AACD;;AAhCgD;;AAAnD,OAAA,CAAA,mBAAA,GAAA,mBAAA;;AAmCA,SAAgB,sBAAhB,CACE,cADF,EACwB;AAEtB,QAAM,aAAa,GAAG,EAAtB;AAEA,GAAA,GAAA,SAAA,CAAA,OAAA,EAAQ,cAAR,EAAyB,OAAD,IAAY;AAClC,UAAM,cAAc,GAAG,IAAI,mBAAJ,CAAwB,OAAxB,EAAiC,YAAjC,EAAvB;AACA,KAAA,GAAA,QAAA,CAAA,OAAA,EAAO,aAAP,EAAsB,cAAtB;AACD,GAHD;AAIA,SAAO,aAAP;AACD;;AAVD,OAAA,CAAA,sBAAA,GAAA,sBAAA;;AAYA,SAAgB,6BAAhB,CACE,KADF,EAEE,iBAFF,EAE2B;AAEzB,SAAO,KAAK,CAAC,IAAN,GAAa,iBAAb,GAAiC,WAAA,CAAA,EAAxC;AACD;;AALD,OAAA,CAAA,6BAAA,GAAA,6BAAA;;AAOA,SAAgB,uBAAhB,CAAwC,QAAxC,EAA0D;AACxD,QAAM,YAAY,GAAG,QAAQ,CAAC,YAAT,CAAsB,IAA3C;AACA,SAAO,YAAY,GAAG,QAAQ,CAAC,GAAxB,GAA8B,WAAA,CAAA,EAArC;AACD;;AAHD,OAAA,CAAA,uBAAA,GAAA,uBAAA","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.buildInProdFollowPrefix = exports.buildBetweenProdsFollowPrefix = exports.computeAllProdsFollows = exports.ResyncFollowsWalker = void 0;\nconst rest_1 = require(\"./rest\");\nconst first_1 = require(\"./first\");\nconst forEach_1 = __importDefault(require(\"lodash/forEach\"));\nconst assign_1 = __importDefault(require(\"lodash/assign\"));\nconst constants_1 = require(\"../constants\");\nconst gast_1 = require(\"@chevrotain/gast\");\n// This ResyncFollowsWalker computes all of the follows required for RESYNC\n// (skipping reference production).\nclass ResyncFollowsWalker extends rest_1.RestWalker {\n    constructor(topProd) {\n        super();\n        this.topProd = topProd;\n        this.follows = {};\n    }\n    startWalking() {\n        this.walk(this.topProd);\n        return this.follows;\n    }\n    walkTerminal(terminal, currRest, prevRest) {\n        // do nothing! just like in the public sector after 13:00\n    }\n    walkProdRef(refProd, currRest, prevRest) {\n        const followName = buildBetweenProdsFollowPrefix(refProd.referencedRule, refProd.idx) +\n            this.topProd.name;\n        const fullRest = currRest.concat(prevRest);\n        const restProd = new gast_1.Alternative({ definition: fullRest });\n        const t_in_topProd_follows = (0, first_1.first)(restProd);\n        this.follows[followName] = t_in_topProd_follows;\n    }\n}\nexports.ResyncFollowsWalker = ResyncFollowsWalker;\nfunction computeAllProdsFollows(topProductions) {\n    const reSyncFollows = {};\n    (0, forEach_1.default)(topProductions, (topProd) => {\n        const currRefsFollow = new ResyncFollowsWalker(topProd).startWalking();\n        (0, assign_1.default)(reSyncFollows, currRefsFollow);\n    });\n    return reSyncFollows;\n}\nexports.computeAllProdsFollows = computeAllProdsFollows;\nfunction buildBetweenProdsFollowPrefix(inner, occurenceInParent) {\n    return inner.name + occurenceInParent + constants_1.IN;\n}\nexports.buildBetweenProdsFollowPrefix = buildBetweenProdsFollowPrefix;\nfunction buildInProdFollowPrefix(terminal) {\n    const terminalName = terminal.terminalType.name;\n    return terminalName + terminal.idx + constants_1.IN;\n}\nexports.buildInProdFollowPrefix = buildInProdFollowPrefix;\n//# sourceMappingURL=follow.js.map"]},"metadata":{},"sourceType":"script"}